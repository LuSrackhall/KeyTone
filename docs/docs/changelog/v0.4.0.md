# `0.4.0` *(2025-02)*

### Bug Fixes

* Refactored the specific functionality of the export album button. Now directly relies on frontend download functionality. No longer uses the approach of uploading a file to get the path (which required electron API) for SDK saving. ([225aeef](https://github.com/LuSrackhall/KeyTone/commit/225aeef6f1a017e199cc23220a4ebf3581d8c01e))
* Fixed a bug where the compressed folder changed the original folder root name when exporting albums ([968654c](https://github.com/LuSrackhall/KeyTone/commit/968654c03f835f47676ccbf99177945426cad1cd))
* Fixed a bug where the export success notification would pop up before users had chosen the save path when exporting albums. (This fix uses the File System Access API to replace the current download attribute solution) ([f751aa4](https://github.com/LuSrackhall/KeyTone/commit/f751aa4871a5c694c52ad669a7142871f7feb474)), closes [#61](https://github.com/LuSrackhall/KeyTone/issues/61)
* Fixed a bug where the chip selector component, affected by h-5.8, couldn't display completely and showed vertical scrollbars. ([d6906d5](https://github.com/LuSrackhall/KeyTone/commit/d6906d5b65bd43d18505faf50aeaa956a64eb926))
* Fixed a bug where the UI wouldn't update when overwriting an existing album during album upload if the overwritten album was currently selected, and optimized update timing. Additionally, added album file metadata retrieval functionality, supporting upload and validation of album file formats, returning relevant metadata information. ([32b81f8](https://github.com/LuSrackhall/KeyTone/commit/32b81f8abaf0a391837e8dcae675aec84545c2ac))
* Fixed a bug where the album list would still have unusable residuals when deleting the last album. ([be7ebdb](https://github.com/LuSrackhall/KeyTone/commit/be7ebdb135048db032de418cefefba7d612fbb61))
* **frontend:** Fixed a potential bug where users would still see a blank, fake unusable keytone pack when reloading the page after their selected keytone pack was externally corrupted (e.g., maliciously deleted). ([372f8b7](https://github.com/LuSrackhall/KeyTone/commit/372f8b762541f4bea15c15bfc6387152b43ef05b))
* **sdk:** Adjusted critical sections to further eliminate potential deadlocks or other unexpected situations in the SDK. ([c5b48e9](https://github.com/LuSrackhall/KeyTone/commit/c5b48e9619f8f6d0eb0ab21f7c960abcc132e633))
* **sdk:** For cases where the loaded keytone pack path doesn't exist, the Viper global variable should be recycled to prevent unknown errors. ([3b40784](https://github.com/LuSrackhall/KeyTone/commit/3b407840275532050cffa68bb34d34eac0f2ad76))
* **sdk:** Fixed a new bug caused by the previous fix where SDK would crash when Viper==nil caused a panic. ([21908e6](https://github.com/LuSrackhall/KeyTone/commit/21908e6f71e1cd8683a79517f334caf7a1b5856f))
* **sdk:** Fixed SDK panic issues. Reviewed the keytone pack module lifecycle and concurrent critical sections, removed unnecessary checks, and implemented locking for necessary critical sections to avoid panic risks. ([226384b](https://github.com/LuSrackhall/KeyTone/commit/226384b6eb888eca0276e2488be41e3b33d5fcae))
* **ui:** 1.Fixed the issue where the selection box for compiling existing sounds was too narrow when nothing was selected; 2.Fixed overflow issues with long names in the internal source file selection box after selection. ([8f48a5a](https://github.com/LuSrackhall/KeyTone/commit/8f48a5a44571e30d445fab695e19f1709d3079dc))
* **ui:** Further fixed issues from the previous commit. This fix relocated SSE callback due to accumulated historical issues -> the initial active fetching and initialization operation in the initData() function's internal lifecycle had become difficult to manage due to long-term maintenance neglect. (If related bug reports continue, relocation and handling of more items may be needed) ([06961ce](https://github.com/LuSrackhall/KeyTone/commit/06961ce059ceaa4a732b28f7937d411345bd6f4e)), closes [#55](https://github.com/LuSrackhall/KeyTone/issues/55)
* **ui:** Further fixed issues from the previous two commits. This fix addresses errors caused by source file lifecycle update delays when global key selected sounds have source files (soundFileList) (as mentioned in the previous commit's notes). (Solution: Directly complete this field's initialization in initData to complete its lifecycle) ([ce1d101](https://github.com/LuSrackhall/KeyTone/commit/ce1d101d6762f25806c6c2a5e3d6dfcec6bd1ca1)), closes [#55](https://github.com/LuSrackhall/KeyTone/issues/55)
* **ui:** Temporarily fixed initialization issues with related configurations in the global key sound effect settings dialog when editing keytone albums. ([55be04c](https://github.com/LuSrackhall/KeyTone/commit/55be04cf7575aec449d17377814e6ba6f2f29924)), closes [#55](https://github.com/LuSrackhall/KeyTone/issues/55)
* **ui:** Clarified essential content for keytone album initialization, defined its lifecycle, ensuring that continuous creation of keytone packs won't erroneously terminate initializing albums. Also, albums won't be displayed until initialization is complete (showing loading animation instead). ([18b59d5](https://github.com/LuSrackhall/KeyTone/commit/18b59d53d9e19fc1f1c37e517007de0d62c348fc))
* **ui:** Through deep fixing, further resolved UI anomaly issues caused by long keytone names in the main page. (This fix mainly addresses label overflow past the selection box close button and the entire selection box scrolling together) ([ab27938](https://github.com/LuSrackhall/KeyTone/commit/ab2793877d570cf871d48a7b21b1adf73165bd10))
* **ui:** Fixed horizontal page overflow issues in the keytone album page's unique selector component caused by long selected album names. (This is the same issue as the recently fixed main page selector component) ([ab9a6a4](https://github.com/LuSrackhall/KeyTone/commit/ab9a6a4b61f23d2a2012b6f3a7ceae6ca96b3768))
* **ui:** Fixed initialization errors in the keytone album page after switching albums. (This error occurred because: The initial reading of press test sound/release test sound related fields from persistence was missed, and incorrectly reinitialized with default data) ([3d705a9](https://github.com/LuSrackhall/KeyTone/commit/3d705a996128c1e9a8399d8cf2b5637630f9ff01)), closes [#55](https://github.com/LuSrackhall/KeyTone/issues/55)
* **ui:** Fixed overflow issues with long names in the top-right corner of edit dialogs (for audio files, sounds, and key sounds). (Handled by removing components for sounds and key sounds, and only showing extension names for audio files) ([ba67f28](https://github.com/LuSrackhall/KeyTone/commit/ba67f28619d9ef52bb763fc948d2da0129b04f64))
* **ui:** Fixed incorrect judgment of whether the current step has been operated after closing the key linkage sound effect step bar. ([385608d](https://github.com/LuSrackhall/KeyTone/commit/385608dada66c5a1d69adc18f563a0b988573ae9)), closes [#55](https://github.com/LuSrackhall/KeyTone/issues/55)
* **ui:** Fixed a bug where created keytone packs became unusable when their initialization process was interrupted. ([3aeb848](https://github.com/LuSrackhall/KeyTone/commit/3aeb848564f2c80f4cf00bb6e3e8dd52db49ed6b))
* **ui:** Fixed a bug where the keytone album component wouldn't disappear after deleting the selected album from the selector. This commit also includes prevention of duplicate rendering bugs during new album creation. ([53213af](https://github.com/LuSrackhall/KeyTone/commit/53213afc6d618e1a4ac63b5eb3415123e1c0d4ae))
* **ui:** Fixed a bug where scroll monitoring was lost after switching albums in the keytone album page. This bug caused the expected collapse button trigger on downward scroll and expand button trigger on upward scroll at the top to become ineffective. ([f2749e7](https://github.com/LuSrackhall/KeyTone/commit/f2749e784f94fd5b149bfb8d4306d70e853762af)), closes [#55](https://github.com/LuSrackhall/KeyTone/issues/55)
* **ui:** Fixed an issue where the top selector in the keytone album page could be overlapped by the album component below in certain situations. Reproduction steps -> scroll to bottom, then click expand button. ([53533a0](https://github.com/LuSrackhall/KeyTone/commit/53533a0dd8f744ee046e2547297c9acfdb121a90))
* **ui:** Fixed potential memory leak issues. (Delete listeners created in the keytone album component before component unmounting) ([b4ecfbd](https://github.com/LuSrackhall/KeyTone/commit/b4ecfbdcd47e4d7f017aa71c6565ef4291a41af0))
* **ui:** Fixed a bug in continuous keytone pack creation. This bug would erroneously assign new content to the previous pack starting from the second pack creation. ([665b14c](https://github.com/LuSrackhall/KeyTone/commit/665b14c3327795be3ea7acf7e70e8bab23290163))
* **ui:** Fixed a bug where the previously added subtle scrollbar for options in the Quasar selector menu disappeared and reverted to line-wrapping strategy after page refresh. ([6743096](https://github.com/LuSrackhall/KeyTone/commit/6743096f049807a3bef3015d1f598ee7b844cfb8))
* **ui:** Fixed a bug where the previously added scrollbar for the Quasar selector disappeared and styles overflowed again after page refresh. ([1f612b6](https://github.com/LuSrackhall/KeyTone/commit/1f612b61dd066ae8b450dbcd27d6caab517adb0e))
* **ui:** Fixed text overflow issues in regular selection boxes within step frames in the audio album component. For chip-based multi-select boxes, changed from ellipsis strategy to overflow scroll strategy. ([35d84b8](https://github.com/LuSrackhall/KeyTone/commit/35d84b85f0bd65486fd478726274a5958a8284a8))
* **ui:** Fixed overflow issues with album name display above the step frame in the audio album component. (Using no-wrap + overflow scroll strategy)(Note: For Quasar's input components, no-wrap + overflow scroll strategy is built-in) ([3e3fc50](https://github.com/LuSrackhall/KeyTone/commit/3e3fc502b18164b492629b91988c819aa7b81575))
* **ui:** Fixed overflow issues with long option names in Q-select dropdown menus. Additionally, this commit unified the scrollbar style for Q-select dropdown menus, abandoning the default classic scrollbar style. ([b63cdde](https://github.com/LuSrackhall/KeyTone/commit/b63cdde8d2befe8123ccee9aa7f81da8645dff7f))
* **ui:** Fixed a bug where English content exceeding length couldn't display normally in Q-select dropdown menus. (Chinese text would wrap automatically) The fix solution makes all font content follow the overflow auto-wrap strategy. ([36ecac8](https://github.com/LuSrackhall/KeyTone/commit/36ecac8c9c8535738eb05a3d8f542690e861b62a))
* **ui:** Fixed overflow issues with the selected items section at the top of the Q-select dropdown menu (currently using dialog mode) in the main page due to long option names. ([d106b98](https://github.com/LuSrackhall/KeyTone/commit/d106b98204ed9c375b635bb0dfb39ab357c82fbb))
* **ui:** Fixed page style anomaly bugs triggered by long keytone album names in the main page. (Implemented no-wrap + overflow scroll strategy) ([2c81c63](https://github.com/LuSrackhall/KeyTone/commit/2c81c6340b957624096c9640786409676e1369cd))
* **ui:** Disabled selector during keytone pack creation to avoid issues similar to those during continuous creation. ([88bb2b2](https://github.com/LuSrackhall/KeyTone/commit/88bb2b235ce49751503d3af3d583a63f40791da2))
* **ui:** During keytone pack creation, certain buttons that might cause creation interruption should be disabled. (Though perhaps overdone, let's keep it for now and consider removal later) ([6ac55cb](https://github.com/LuSrackhall/KeyTone/commit/6ac55cb5cddcf8fea311e299b1c1bce910f35381))
* **ui:** In the keytone album page, removed the non-design-compliant "Confirm" and "Cancel" buttons from the single key sound effect settings dialog in key linkage sound settings, replacing them with a more appropriate standalone "Close" button. ([8a31d4e](https://github.com/LuSrackhall/KeyTone/commit/8a31d4e05b5baae7a6a35504621ff4f6b0cffe09)), closes [#55](https://github.com/LuSrackhall/KeyTone/issues/55)

### Features

* Implemented .ktalbum file format, including encryption and validation ([575351a](https://github.com/LuSrackhall/KeyTone/commit/575351a64022a8f193d1c7d2f3b8d75eea0f0bd2))
* Implemented the specific functionality of the export album button. ([485b8df](https://github.com/LuSrackhall/KeyTone/commit/485b8df361b2224e376bd786fb14d91696a61df3))
* Implemented the actual functionality of the import album button. ([6fe8936](https://github.com/LuSrackhall/KeyTone/commit/6fe8936c290db5335171f6ba7b5c6a7b16183e8a))
* Added album overwrite import functionality, handling cases where albums already exist. Now users can choose to overwrite or cancel import when an album already exists, instead of directly showing an error. ([ef50487](https://github.com/LuSrackhall/KeyTone/commit/ef504875ab655f8885497d81711492bb3a6277e1))
* Added album metadata support and optimized import album validation logic ([1d58f48](https://github.com/LuSrackhall/KeyTone/commit/1d58f48ff08d3e9d46257bc638e9291ad563208a))
* Enhanced the delete current album button functionality in the keytone album page. ([caefec4](https://github.com/LuSrackhall/KeyTone/commit/caefec45442675767c2b02560a1b35fb6acad1cc))
* Added functionality to import albums as new albums when encountering existing ones, allowing users to choose between overwriting, saving as new album, or canceling import. ([865eaa3](https://github.com/LuSrackhall/KeyTone/commit/865eaa3092c85bb304e7364d8b566d0236ded847))
* Added empty state prompts and related styles to the keytone album selector in the keytone album page, improving user experience. ([2db2e67](https://github.com/LuSrackhall/KeyTone/commit/2db2e671a351fe9674f6c55d3c6e4199c9c62490))
* Added empty state prompts and navigation functionality to the keytone album selector in the main page, improving user experience ([09620b3](https://github.com/LuSrackhall/KeyTone/commit/09620b31d8a8d48e9dbbd75fdc874055fc50bdb4))
* Re-implemented the create keytone pack button functionality in the newly designed keytone album page. ([c391399](https://github.com/LuSrackhall/KeyTone/commit/c3913999a29e54d769093be3b9300efbb3f6d865))
* **tools:** Initialized ktalbum-tools CLI tool, implementing file unpacking functionality ([640a0de](https://github.com/LuSrackhall/KeyTone/commit/640a0dece640f5ecc63f279aa7214d838a4e375f))
* **tools:** Added Web service and frontend interface to ktalbum-tools ([3cb5bb2](https://github.com/LuSrackhall/KeyTone/commit/3cb5bb229b6893db5aecbbed18c4dbe8f46c61cc))
* **tools:** Enhanced file information retrieval and added file integrity checking ([a22b2b8](https://github.com/LuSrackhall/KeyTone/commit/a22b2b83830c4ca61018f763e0e4849c30d13178))
* **ui:** For options in Quasar selector menus, abandoned the line-wrapping approach in favor of a scrolling approach, adding corresponding subtle scrollbars for easier user viewing. ([44dc336](https://github.com/LuSrackhall/KeyTone/commit/44dc336687f45e4c1f9cc4e2fd4012864deafdda))
* **ui:** Abandoned the old keytone album page design in favor of the new design. ([a6b4d14](https://github.com/LuSrackhall/KeyTone/commit/a6b4d14349aee00424e6fb3a7661829316372229)), closes [#55](https://github.com/LuSrackhall/KeyTone/issues/55)
* **ui:** Added clear selection functionality to management selectors in edit dialogs (such as audio files, sounds, key sounds) in the keytone album component. ([5e9f601](https://github.com/LuSrackhall/KeyTone/commit/5e9f601a42e4e718ebce89b17eb90c74fdcbb1da))
* **ui:** Added selector-style scrollbars to input boxes of Quasar selectors across all pages. ([5f14469](https://github.com/LuSrackhall/KeyTone/commit/5f144692092e12398b7b3807a0efa833cd0a838e))
* **ui:** Added four functional buttons for keytone albums: create, import, export, and delete. ([dcc3a1a](https://github.com/LuSrackhall/KeyTone/commit/dcc3a1a6c07dd292847e474f18e27663e3b4b92a))

### Reverts

* Revert "chore(ui): Added animation for components moving up when upper components collapse, as this movement previously had no animation." ([9ea8478](https://github.com/LuSrackhall/KeyTone/commit/9ea8478a576fb20d399b1b5bdf4ad336026c3837)), closes [#55](https://github.com/LuSrackhall/KeyTone/issues/55)