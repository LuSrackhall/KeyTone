# Album Export (UI Flow)

## ADDED Requirements

### Requirement: 导出前签名策略与要求对话框（首次导出可选）

系统在“导出键音专辑”前 SHALL 提供“签名策略与要求”的对话框：
- 当专辑尚无任何签名痕迹时（首次导出），允许选择“需要签名”或“无需签名”。
- 当选择“二次创作必须通过当前签名作者授权”时，系统 MUST 要求填写“联系方式”文本，随配置一并导出。
- 当专辑已有签名痕迹（非首次导出）时，不允许选择“无需签名”（MUST 禁用或隐藏该选项）。

#### Scenario: 首次导出—选择无需签名

- WHEN 专辑无签名痕迹，用户在对话框中选择“无需签名”并点击“继续”
- THEN 对话框关闭并继续下一导出步骤（无需签名选择）

#### Scenario: 首次导出—勾选需授权并填写联系方式

- WHEN 专辑无签名痕迹，用户勾选“二次创作必须通过当前签名作者授权”
- THEN 出现“联系方式”必填输入区域，未填写时“继续”按钮处于禁用状态
- AND 填写后可点击“继续”，联系方式将被打包入配置

#### Scenario: 非首次导出—必须签名

- GIVEN 专辑已有至少一条签名痕迹
- WHEN 用户点击“导出”
- THEN “无需签名”选项不可用（禁用或不显示），流程将要求选择签名

---

### Requirement: 授权门控对话框（在签名选择之前）

当专辑策略标记“二次创作需授权”且当前导出会话未被授权时，系统 SHALL 在签名选择前显示“授权门控”对话框：
- MUST 展示原作者联系方式（来自专辑配置）。
- MUST 提供“导入授权文件”入口；在未导入前，继续按钮 MUST 禁用。
- SHOULD 提供“如何获得授权？”帮助链接。

#### Scenario: 未授权时阻断签名选择

- GIVEN 专辑配置启用了“二次创作需授权”，当前会话尚未导入授权文件
- WHEN 用户点击导出
- THEN 先显示“授权门控”对话框，签名选择未出现

#### Scenario: 导入授权文件后继续

- WHEN 用户通过门控对话框导入授权文件（前端可用占位成功）
- THEN “继续”按钮变为可点击，点击后进入签名选择

#### Scenario: 取消授权门控

- WHEN 用户点击“取消”
- THEN 关闭门控对话框并中止导出流程

---

### Requirement: 签名选择对话框（支持创建新签名）

系统 SHALL 提供“签名选择”对话框用于在导出时选择签名：
- MUST 展示来自“签名管理”的签名列表（名称、简介、缩略图）。
- MUST 提供搜索/筛选与空态提示。
- MUST 提供“新建签名”入口，打开签名创建对话框（复用签名管理 UI）。
- MUST 支持选择高亮与确认/取消。

#### Scenario: 从现有签名中选择

- GIVEN 用户已有至少一个签名
- WHEN 打开签名选择对话框并点击某个签名卡片
- THEN 该项被高亮为选中，点击“确认”继续后续导出流程

#### Scenario: 列表为空时引导创建

- GIVEN 签名列表为空
- WHEN 打开签名选择对话框
- THEN 显示空态与“新建签名”按钮，点击后弹出创建对话框

#### Scenario: 新建签名后回流选择

- WHEN 在签名选择对话框内点击“新建签名”并完成创建（或占位成功）
- THEN 新建项出现在列表中并处于选中或可立即选中状态

---

### Requirement: 导出编排状态机（前端流程）

系统 SHALL 编排导出前的对话链路，遵循以下顺序与条件：
1) 点击“导出”触发。
2) 若专辑无签名痕迹 → 先弹“签名策略与要求”。
3) 若策略启用“需授权”且当前未授权 → 弹“授权门控”。
4) 若当前步骤要求签名 → 弹“签名选择”。
5) 返回调用方以继续真实的导出逻辑（本变更不实现）。

#### Scenario: 零签名且无需签名

- GIVEN 专辑无签名痕迹
- WHEN 用户在“签名策略”选择“无需签名”并继续
- THEN 跳过授权门控与签名选择，直接回调导出

#### Scenario: 零签名且需要签名

- GIVEN 专辑无签名痕迹
- WHEN 用户选择“需要签名”并继续
- THEN （若启用需授权且未授权则先门控）随后打开签名选择

#### Scenario: 已有签名（必须签名）

- GIVEN 专辑已有签名痕迹
- WHEN 用户点击导出
- THEN （若启用需授权且未授权则先门控）随后打开签名选择

---

### Requirement: 可访问性与 UX 细节

系统 SHOULD 提供基本可访问性与良好反馈：
- 对话框 MUST 支持键盘可达性（Tab/Shift+Tab、Enter、Esc）。
- 关键操作 MUST 有 Loading/Disabled 态，避免重复提交。
- 输入校验错误 MUST 就地提示并可读（屏幕阅读器友好）。

#### Scenario: 键盘流畅操作

- WHEN 用户使用键盘在对话框中导航
- THEN 焦点可预期移动，Enter 触发主操作，Esc 关闭/返回

#### Scenario: 校验提示

- WHEN 勾选“需授权”但未填写联系方式
- THEN “继续”按钮禁用并提示联系方式必填

---

Note:
- 本变更仅为 UI/UX 规范与前端流转，不要求真实业务逻辑；后续实现可接入后端鉴权、授权文件校验和签名写入。
- 相关能力参考 `changes/add-signature-management/specs/signature-management/spec.md`，本对话框中“新建签名”应复用既有创建 UI 约束（名称必填、图片规格等）。
