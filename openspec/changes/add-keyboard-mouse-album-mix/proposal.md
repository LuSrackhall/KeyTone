# Change: 支持键盘/鼠标键音专辑混搭播放

## Why

当前版本的播放模型默认“一个专辑同时负责键盘与鼠标的声音映射”。在加入鼠标按键支持后，这个模型出现明显痛点：用户可能希望使用 A 专辑的键盘音、B 专辑的鼠标音，但现有架构只能加载并使用一个专辑配置，无法在事件路由层区分不同输入设备使用不同专辑。

该痛点会直接影响“键盘+鼠标套装”与“混搭偏好”两类用户：
- 创作者可能制作了更专注的键盘专辑/鼠标专辑
- 使用者可能希望在两套专辑中自由组合

## What Changes

- 新增“播放路由（Playback Routing）”概念：允许用户分别选择用于键盘与鼠标事件的播放专辑。
- 在不启用混搭时保持旧行为：仍然以单一专辑覆盖全部输入事件。
- SDK 播放侧从“单一全局 Viper 配置”升级为“按输入类型选择配置源（键盘/鼠标）”，保证播放热路径不做磁盘 IO。
- 前端 UI 增加一个轻量的“分离/统一”开关与第二个选择器（鼠标专辑），并提供清晰的默认/回退规则。

**主页行为调整（关键）**

- 主页的专辑选择器 SHALL 以“播放路由”为权威数据源。
  - 统一模式：仅显示一个选择器（统一播放专辑）。
  - 分离模式：显示两个选择器（键盘播放专辑、鼠标播放专辑）。
- `main_home.selected_key_tone_pkg`（历史字段）在分离模式下 SHALL 不再作为“播放专辑”的权威来源；仅用于兼容迁移与必要的回退。

**键音专辑页行为调整（关键）**

- 键音专辑页 SHALL 仅承担“键音专辑的创作/修改”。
- 进入键音专辑页时，系统 MUST 临时切换到 `editor` 播放来源模式：此时播放使用“可编辑专辑配置”（`LoadConfig` + 可写配置 + SSE），并暂停主页的路由播放。
- 返回主页时，系统 MUST 恢复路由播放模式，并重新 apply 路由以确保只读快照最新。
- 键音专辑页对“编辑专辑”的记忆使用历史字段 `main_home.selected_key_tone_pkg`，与主页路由选择互不影响。
- 键音专辑页的“编辑提示”使用底部通知展示，并提供关闭与“不再提示”。

**兼容性目标**
- 默认行为不变：老用户升级后仍表现为“一个专辑同时用于键盘+鼠标”。
- 旧专辑格式不变：不要求专辑文件结构升级。

**回退策略（新增）**
- 分离模式下，鼠标专辑缺失的默认行为是使用内嵌测试音（彻底分离）。
- 用户可在设置页面手动开启“鼠标回退到键盘”选项，开启后鼠标专辑缺失将回退使用键盘专辑。

## Impact

- Affected specs:
  - 新增能力规格（变更 delta）：`playback-album-routing`
- Affected frontend:
  - 主页专辑选择 UI（当前仅有一个选择框）需要支持“鼠标专辑选择”
  - 设置存储需要新增持久化字段（键盘/鼠标专辑路径、模式）
- Affected SDK:
  - `keyEvent` → `keySound` 的事件路径需要能够根据输入类型选择不同的配置源
  - `audioPackage/config` 的加载逻辑需要支持“加载成独立只读配置实例”以供播放路由缓存

## Out of Scope（本次不做）

- 不引入“自动合并生成新专辑文件”的导出能力
- 不改变专辑编辑器的配置结构（仍由专辑自身决定其 key_tone.single 的键位映射范围）
- 不改动签名/导出/加密流程
